<app-navbar></app-navbar>
<div class="site-container">
  <h2>Events</h2>
  <div *ngIf="events.length === 0" class="alert alert-info">No completed events available.</div>

  <div class="row" *ngIf="pagedEvents.length > 0">
    <div class="w-25" *ngFor="let e of pagedEvents">
      <a [routerLink]="['/events', e.id]" class="event-link">
        <div class="card mb-3">
          <img height="200" [src]="e.image || defaultImage" class="img-fluid rounded-start" alt="event image"  />
          <div class="card-body">
            <h5 class="card-title">{{e.title}}</h5>
            <p class="card-text text-muted">Category: {{e.category || 'General'}}</p>
            <p class="card-text">{{e.description}}</p>
            <p class="card-text"><small class="text-muted">Organizer: {{getOrganizerName(e.organizerId)}}</small></p>
            <div class="feeds" *ngIf="e.feedbacks && e.feedbacks.length">
              <h6>Feedback</h6>
              <ul class="list-unstyled">
                <li>
                  <div class="border rounded p-2 mb-2">
                    <strong>{{getGuestNameByFeedbackId(e.feedbacks[0])}}</strong>
                    <div class="small text-muted">Rating: {{getFeedbackById(e.feedbacks[0])?.rating}}</div>
                    <div>{{getFeedbackById(e.feedbacks[0])?.comment}}</div>
                  </div>
                </li>
              </ul>
            </div>
            <div *ngIf="!e.feedbacks || e.feedbacks.length === 0" class="text-muted">No feedback yet.</div>
            <div class="mt-2">
              <button class="btn btn-sm btn-outline-primary" (click)="onLeaveFeedback(e.id, $event)">Leave Feedback</button>
            </div>
          </div>
        </div>
      </a>
    </div>
     <div *ngIf="totalPages > 1" class="pagination-controls mt-4">
    <button class="btn btn-outline-secondary btn-sm mx-1" [disabled]="currentPage === 1" (click)="setPage(currentPage - 1)">&laquo; Prev</button>
    <ng-container *ngFor="let p of [].constructor(totalPages); let i = index">
      <button class="btn btn-outline-primary btn-sm mx-1" [class.active]="currentPage === (i+1)" (click)="setPage(i+1)">{{i+1}}</button>
    </ng-container>
    <button class="btn btn-outline-secondary btn-sm mx-1" [disabled]="currentPage === totalPages" (click)="setPage(currentPage + 1)">Next &raquo;</button>
  </div>
  </div>
</div>

<app-footer></app-footer>
